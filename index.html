<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3.js Three Scenes with Index Buttons</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
    <style>
        /* Basic styling */
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding-top: 20px;
        }

        .scene {
            display: none;
        }

        .scene.active {
            display: block;
        }

        .button-container {
            margin-top: 20px;
        }

        .button-container button {
            margin: 0 10px;
            padding: 10px 20px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }

        .button-container button:hover {
            background-color: #0056b3;
        }
        circle {
            fill: black;
        }
        .annotation text {
            font-family: Arial, sans-serif;
            font-size: 12px;
            fill: #333;
        }
        .annotation circle {
            fill: steelblue;
            stroke: #fff;
            stroke-width: 2px;
        }
        .tooltip {
            position: absolute;
            text-align: left;
            padding: 5px;
            font-size: 12px;
            background: lightgray;
            border: 1px solid #ddd;
            border-radius: 3px;
            pointer-events: none;
        }
        .label {
            font-size: 12px;
            fill: black;
        }
        .line {
            fill: none;
            stroke-width: 3px;
        }
        .line:hover {
            stroke: orange;
            stroke-width: 5px;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <!-- Scene 1: Home -->
    <div class="scene active" id="scene_home">
        <h2>Overview of Life Expectancy 1980-2022 by World Regions</h2>
        <svg width="800" height="500"></svg>
    </div>

    <!-- Scene 2: Europe -->
    <div class="scene" id="scene_eu">
        <h2>Life Expectancy Change in Europe</h2>
        <svg width="800" height="500"></svg>
        <div class="tooltip" style="opacity: 0;"></div>
    </div>

    <!-- Scene 3: North America -->
    <div class="scene" id="scene_na">
        <h2>Life Expectancy Change in North America</h2>
        <svg width="800" height="500"></svg>
    </div>

    <!-- Scene 4: East Asia & Pacific -->
    <div class="scene" id="scene_ap">
        <h2>Life Expectancy Change in East Asia & Pacific</h2>
        <svg width="800" height="500"></svg>
    </div>

    <!-- Home Buttons -->
    <div class="button-container">
        <button onclick="click_home_button()">Back to Overview</button>
    </div>

    <script>
        // D3.js code for each scene

        // Scene 1: Main Chart
        const svg_home = d3.select('#scene_home svg');
        load_scene_home();

        // Scene 2: Europe
        const svg_eu = d3.select('#scene_eu svg');

        // Scene 3: North America
        const svg_na = d3.select('#scene_na svg');

        // Scene 4: East Asia & Pacific
        const svg_ap = d3.select('#scene_ap svg');

        function click_home_button(){
            d3.selectAll('.scene')
                .classed('active', false);
            d3.select('#scene_home')
                .classed('active', true);
            load_scene_home()
        }

        async function load_scene_home() {

            const data = await d3.csv('https://oliverwang008.github.io/global_life.csv');
            const margin = { top: 10, right: 20, bottom: 10, left: 20 };
            const width = 800 - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;

            // Append the SVG object to the chart div
            svg_home.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // X scale and axis
            const x = d3.scaleLinear()
                //.domain(d3.extent(data, d => d.year))
                .domain([1980, 2024])
                .range([margin.left, width]);

            svg_home.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));

            // Y scale and axis
            const y = d3.scaleLinear()
                .domain([64, 83])
                .range([height, 0]);

            svg_home.append("g")
                .attr("transform", `translate(${margin.left},0)`)
                .call(d3.axisLeft(y).tickFormat(d3.format(",.0f")));

            // Line function
            const line_eu = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.europe));

            const line_na = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.north_america));

            const line_ap = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.east_asia_pacific));

            // Draw the line
            svg_home.append("path")
                .datum(data)
                .attr('class', 'line')
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 3)
                .attr("d", line_eu)
                .on('click', function (event) {
                    d3.selectAll('.scene')
                        .classed('active', false);
                    d3.select('#scene_eu')
                        .classed('active', true);
                    load_scene_eu()
                });

            svg_home.append("path")
                .datum(data)
                .attr('class', 'line')
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 3)
                .attr("d", line_na)
                .on('click', function (event) {
                    d3.selectAll('.scene')
                        .classed('active', false);
                    d3.select('#scene_na')
                        .classed('active', true);
                    load_scene_na()
                });

            svg_home.append("path")
                .datum(data)
                .attr('class', 'line')
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 3)
                .attr("d", line_ap)
                .on('click', function (event) {
                    d3.selectAll('.scene')
                        .classed('active', false);
                    d3.select('#scene_ap')
                        .classed('active', true);
                    load_scene_ap()
                });
            
            svg_home.append('text')
                .attr('class', 'label')
                .attr('x', x(data[data.length - 1].year))
                .attr('y', y(data[data.length - 1].north_america))
                .attr('dy', -10)
                .attr('text-anchor', 'middle')
                .text('North America');
            
            svg_home.append("circle")
                .attr("class", "dot")
                .attr("cx", d => x(data[data.length - 1].year))
                .attr("cy", d => y(data[data.length - 1].north_america))
                .attr("r", 5);
            
            svg_home.append('text')
                .attr('class', 'label')
                .attr('x', x(data[data.length - 1].year))
                .attr('y', y(data[data.length - 1].europe))
                .attr('dy', 20)
                .attr('text-anchor', 'middle')
                .text('Europe');

            svg_home.append("circle")
                .attr("class", "dot")
                .attr("cx", d => x(data[data.length - 1].year))
                .attr("cy", d => y(data[data.length - 1].europe))
                .attr("r", 5);
            
            svg_home.append('text')
                .attr('class', 'label')
                .attr('x', x(data[data.length - 1].year))
                .attr('y', y(data[data.length - 1].east_asia_pacific))
                .attr('dy', 25)
                .attr('text-anchor', 'middle')
                .text('East Asia & Pacific');
            
            svg_home.append("circle")
                .attr("class", "dot")
                .attr("cx", d => x(data[data.length - 1].year))
                .attr("cy", d => y(data[data.length - 1].east_asia_pacific))
                .attr("r", 5);
        }

        async function load_scene_eu() {
            const data = await d3.csv('https://oliverwang008.github.io/global_life.csv');
            const margin = { top: 10, right: 20, bottom: 10, left: 20 };
            const width = 800 - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;

            // Append the SVG object to the chart div
            svg_eu.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // X scale and axis
            const x = d3.scaleLinear()
                //.domain(d3.extent(data, d => d.year))
                .domain([1980, 2024])
                .range([margin.left, width]);

            svg_eu.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));

            // Y scale and axis
            const y = d3.scaleLinear()
                .domain([64, 83])
                .range([height, 0]);

            svg_eu.append("g")
                .attr("transform", `translate(${margin.left},0)`)
                .call(d3.axisLeft(y).tickFormat(d3.format(",.0f")));

            // Line function
            const line_eu = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.europe));

            const line_na = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.north_america));

            const line_ap = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.east_asia_pacific));

            // Draw the line
            svg_eu.append("path")
                .datum(data)
                .attr('class', 'line')
                .attr("fill", "none")
                .attr("stroke", "lightgray")
                .attr("stroke-width", 3)
                .attr("d", line_na)
                .on('click', function (event) {
                    d3.selectAll('.scene')
                        .classed('active', false);
                    d3.select('#scene_na')
                        .classed('active', true);
                    load_scene_na()
                });
            
            svg_eu.append("path")
                .datum(data)
                .attr('class', 'line')
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 3)
                .attr("d", line_eu);

            svg_eu.append("path")
                .datum(data)
                .attr('class', 'line')
                .attr("fill", "none")
                .attr("stroke", "lightgray")
                .attr("stroke-width", 3)
                .attr("d", line_ap)
                .on('click', function (event) {
                    d3.selectAll('.scene')
                        .classed('active', false);
                    d3.select('#scene_ap')
                        .classed('active', true);
                    load_scene_ap()
                });

            const type = d3.annotationCalloutCircle

            const annotations = [
                {
                    note: {
                        label: "COVID-19 Global Pandemic",
                        title: "Early 2020s"
                    },
                    //can use x, y directly instead of data
                    data: { year: 2020, value: 81.49343123 },
                    dy: 10,
                    dx: -20
                },
                {
                    note: {
                        label: "HIV/AIDS Crisis",
                        title: "Early 2000s"
                    },
                    //can use x, y directly instead of data
                    data: { year: 2002, value: 78.63019248 },
                    dy: 30,
                    dx: 0
                },
                {
                    note: {
                        label: "Soviet Union Transition",
                        title: "Late 1980s"
                    },
                    //can use x, y directly instead of data
                    data: { year: 1990, value: 75.81149745 },
                    dy: -30,
                    dx: -20
                }]

            const makeAnnotations = d3.annotation()
                //.editMode(true)
                //also can set and override in the note.padding property
                //of the annotation object
                .notePadding(10)
                .type(type)
                //accessors & accessorsInverse not needed
                //if using x, y in annotations JSON
                .accessors({
                    x: d => x(d.year),
                    y: d => y(d.value)
                })
                .annotations(annotations)

            svg_eu.append("g")
                //.attr("class", "annotation-group")
                .call(makeAnnotations)
        }

        async function load_scene_na() {
            const data = await d3.csv('https://oliverwang008.github.io/global_life.csv');
            const margin = { top: 10, right: 20, bottom: 10, left: 20 };
            const width = 800 - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;

            // Append the SVG object to the chart div
            svg_na.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // X scale and axis
            const x = d3.scaleLinear()
                //.domain(d3.extent(data, d => d.year))
                .domain([1980, 2024])
                .range([margin.left, width]);

            svg_na.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));

            // Y scale and axis
            const y = d3.scaleLinear()
                .domain([64, 83])
                .range([height, 0]);

            svg_na.append("g")
                .attr("transform", `translate(${margin.left},0)`)
                .call(d3.axisLeft(y).tickFormat(d3.format(",.0f")));

            // Line function
            const line_eu = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.europe));

            const line_na = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.north_america));

            const line_ap = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.east_asia_pacific));

            // Draw the line
            svg_na.append("path")
                .datum(data)
                .attr('class', 'line')
                .attr("fill", "none")
                .attr("stroke", "lightgray")
                .attr("stroke-width", 3)
                .attr("d", line_eu)
                .on('click', function (event) {
                    d3.selectAll('.scene')
                        .classed('active', false);
                    d3.select('#scene_eu')
                        .classed('active', true);
                    load_scene_eu()
                });

            svg_na.append("path")
                .datum(data)
                .attr('class', 'line')
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 3)
                .attr("d", line_na);

            svg_na.append("path")
                .datum(data)
                .attr('class', 'line')
                .attr("fill", "none")
                .attr("stroke", "lightgray")
                .attr("stroke-width", 3)
                .attr("d", line_ap)
                .on('click', function (event) {
                    d3.selectAll('.scene')
                        .classed('active', false);
                    d3.select('#scene_ap')
                        .classed('active', true);
                    load_scene_ap()
                });

            const type = d3.annotationCalloutCircle

            const annotations = [
                {
                    note: {
                        label: "AIDS Epidemic and Chronic Diseases",
                        title: "Mid 1980s"
                    },
                    //can use x, y directly instead of data
                    data: { year: 1985, value: 74.73592874 },
                    dy: -50,
                    dx: 0
                },
                {
                    note: {
                        label: "Economic Recession",
                        title: "Early 1990s"
                    },
                    //can use x, y directly instead of data
                    data: { year: 1993, value: 75.6464215 },
                    dy: 30,
                    dx: 0
                },
                {
                    note: {
                        label: "Opioid Epidemic Crisis",
                        title: "Mid 2010s"
                    },
                    //can use x, y directly instead of data
                    data: { year: 2016, value: 78.87973542 },
                    dy: 30,
                    dx: -20
                },
                {
                    note: {
                        label: "COVID-19 Global Pandemic",
                        title: "Early 2020s"
                    },
                    //can use x, y directly instead of data
                    data: { year: 2021, value: 76.87265827 },
                    dy: 60,
                    dx: -10
                }]

            const makeAnnotations = d3.annotation()
                //.editMode(true)
                //also can set and override in the note.padding property
                //of the annotation object
                .notePadding(10)
                .type(type)
                //accessors & accessorsInverse not needed
                //if using x, y in annotations JSON
                .accessors({
                    x: d => x(d.year),
                    y: d => y(d.value)
                })
                .annotations(annotations)

            svg_na.append("g")
                //.attr("class", "annotation-group")
                .call(makeAnnotations)
            
        }

        async function load_scene_ap() {
            const data = await d3.csv('https://oliverwang008.github.io/global_life.csv');
            const margin = { top: 10, right: 20, bottom: 10, left: 20 };
            const width = 800 - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;

            // Append the SVG object to the chart div
            svg_na.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // X scale and axis
            const x = d3.scaleLinear()
                //.domain(d3.extent(data, d => d.year))
                .domain([1980, 2024])
                .range([margin.left, width]);

            svg_ap.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));

            // Y scale and axis
            const y = d3.scaleLinear()
                .domain([64, 83])
                .range([height, 0]);

            svg_ap.append("g")
                .attr("transform", `translate(${margin.left},0)`)
                .call(d3.axisLeft(y).tickFormat(d3.format(",.0f")));

            // Line function
            const line_eu = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.europe));

            const line_na = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.north_america));

            const line_ap = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.east_asia_pacific));

            // Draw the line
            svg_ap.append("path")
                .datum(data)
                .attr('class', 'line')
                .attr("fill", "none")
                .attr("stroke", "lightgray")
                .attr("stroke-width", 3)
                .attr("d", line_eu)
                .on('click', function (event) {
                    d3.selectAll('.scene')
                        .classed('active', false);
                    d3.select('#scene_eu')
                        .classed('active', true);
                    load_scene_eu()
                });

            svg_ap.append("path")
                .datum(data)
                .attr('class', 'line')
                .attr("fill", "none")
                .attr("stroke", "lightgray")
                .attr("stroke-width", 3)
                .attr("d", line_na)
                .on('click', function (event) {
                    d3.selectAll('.scene')
                        .classed('active', false);
                    d3.select('#scene_na')
                        .classed('active', true);
                    load_scene_na()
                });

            svg_ap.append("path")
                .datum(data)
                .attr('class', 'line')
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 3)
                .attr("d", line_ap);

            const type = d3.annotationCalloutCircle

            const annotations = [
                {
                    note: {
                        label: "COVID-19 Global Pandemic",
                        title: "Early 2020s"
                    },
                    //can use x, y directly instead of data
                    data: { year: 2021, value: 76.39329502 },
                    dy: 60,
                    dx: -10
                },
                {
                    note: {
                        label: "SARS Outbreak",
                        title: "Early 2000s"
                    },
                    //can use x, y directly instead of data
                    data: { year: 2003, value: 72.86440322 },
                    dy: 30,
                    dx: 0
                },
                {
                    note: {
                        label: "HIV/AIDS Epidemic",
                        title: "Late 1990s"
                    },
                    //can use x, y directly instead of data
                    data: { year: 1998, value: 70.97034433 },
                    dy: -30,
                    dx: -20
                }]

            const makeAnnotations = d3.annotation()
                //.editMode(true)
                //also can set and override in the note.padding property
                //of the annotation object
                .notePadding(10)
                .type(type)
                //accessors & accessorsInverse not needed
                //if using x, y in annotations JSON
                .accessors({
                    x: d => x(d.year),
                    y: d => y(d.value)
                })
                .annotations(annotations)

            svg_ap.append("g")
                //.attr("class", "annotation-group")
                .call(makeAnnotations)

        }

    </script>

</body>

</html>