<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3.js Three Scenes with Index Buttons</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
    <style>
        /* Basic styling */
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding-top: 20px;
        }

        .scene {
            display: none;
        }

        .scene.active {
            display: block;
        }

        .button-container {
            margin-top: 20px;
        }

        .button-container button {
            margin: 0 10px;
            padding: 10px 20px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }

        .button-container button:hover {
            background-color: #0056b3;
        }
        circle {
            fill: lightblue;
            stroke: black;
        }
        .annotation text {
            font-family: Arial, sans-serif;
            font-size: 12px;
            fill: #333;
        }
        .annotation circle {
            fill: steelblue;
            stroke: #fff;
            stroke-width: 2px;
        }
    </style>
</head>

<body>

    <!-- Scene 1: Bar Chart -->
    <div class="scene active" id="scene1">
        <h2>EU Life Expectancy Time Series</h2>
        <svg width="800" height="500"></svg>
    </div>

    <!-- Scene 2: Scatter Plot -->
    <div class="scene" id="scene2">
        <h2>Life Expectancy by EU Countries</h2>
        <svg width="800" height="500"></svg>
    </div>

    <!-- Scene 3: Line Chart -->
    <div class="scene" id="scene3">
        <h2>Life Expectancy vs GDP</h2>
        <svg width="800" height="500"></svg>
    </div>

    <!-- Index Buttons -->
    <div class="button-container">
        <button onclick="showScene(1)">Scene 1</button>
        <button onclick="showScene(2)">Scene 2</button>
        <button onclick="showScene(3)">Scene 3</button>
    </div>

    <script>
        // D3.js code for each scene

        // Scene 1: Bar Chart
        const svg1 = d3.select('#scene1 svg');
        loadSceneOne();

        // Scene 2: Scatter Plot
        const svg2 = d3.select('#scene2 svg');

        // Scene 3: Line Chart
        const svg3 = d3.select('#scene3 svg');

        // Function to switch scenes
        function showScene(sceneIndex) {
            // Hide all scenes
            d3.selectAll('.scene')
                .classed('active', false);

            // Show the selected scene
            if (sceneIndex == 1) {
                d3.select(`#scene${sceneIndex}`)
                    .classed('active', true);
                loadSceneOne();
            } else if (sceneIndex == 2){
                d3.select(`#scene${sceneIndex}`)
                    .classed('active', true);
                loadSceneTwo();
            } else {
                d3.select(`#scene${sceneIndex}`)
                    .classed('active', true);
                loadSceneThree();
            }
        }

        async function loadSceneOne() {

            const data = await d3.csv('https://oliverwang008.github.io/eu_life.csv');
            const margin = { top: 10, right: 20, bottom: 10, left: 20 };
            const width = 800 - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;

            // Append the SVG object to the chart div
            svg1.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // X scale and axis
            const x = d3.scaleLinear()
                .domain(d3.extent(data, d => d.year))
                .range([margin.left, width]);

            svg1.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));

            // Y scale and axis
            const y = d3.scaleLinear()
                .domain([d3.min(data, d => d.value), d3.max(data, d => d.value)])
                .range([height, 0]);

            svg1.append("g")
                .attr("transform", `translate(${margin.left},0)`)
                .call(d3.axisLeft(y).tickFormat(d3.format(",.0f")));

            // Line function
            const line = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.value));

            // Draw the line
            svg1.append("path")
                .datum(data)
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 2)
                .attr("d", line);

            const type = d3.annotationCalloutCircle

            const annotations = [
            {
                note: {
                    label: "COVID-19 Global Pandemic",
                    title: "Early 2020s"
                },
                //can use x, y directly instead of data
                data: { year: 2020, value: 80.45086913 },
                dy: 60,
                dx: -10
            },
            {
                note: {
                    label: "HIV/AIDS Crisis",
                    title: "Early 2000s"
                },
                //can use x, y directly instead of data
                data: { year: 2002, value: 77.5310033 },
                dy: 30,
                dx: 0
            },
            {
                    note: {
                        label: "Soviet Union Transition",
                        title: "Late 1980s"
                    },
                    //can use x, y directly instead of data
                    data: { year: 1989, value: 74.65464948 },
                    dy: -30,
                    dx: -20
            },
            {
                    note: {
                        label: "Post-War Economic Transistions",
                        title: "Late 1960s"
                    },
                    //can use x, y directly instead of data
                    data: { year: 1969, value: 70.72180243 },
                    dy: -30,
                    dx: 20
            }]

            const makeAnnotations = d3.annotation()
                //.editMode(true)
                //also can set and override in the note.padding property
                //of the annotation object
                .notePadding(10)
                .type(type)
                //accessors & accessorsInverse not needed
                //if using x, y in annotations JSON
                .accessors({
                    x: d => x(d.year),
                    y: d => y(d.value)
                })
                .annotations(annotations)

            svg1.append("g")
                //.attr("class", "annotation-group")
                .call(makeAnnotations)
        }

        async function loadSceneTwo() {

            const data = await d3.csv('https://oliverwang008.github.io/country_life_gdp.csv');
            const margin = { top: 10, right: 10, bottom: 10, left: 80 };
            const width = 800 - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;

            // Append SVG to the chart div
            svg2.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // X scale
            const x = d3.scaleLinear()
                .domain([70, d3.max(data, d => d.life)])
                .range([0, width]);

            // Y scale
            const y = d3.scaleBand()
                .domain(data.map(d => d.country))
                .range([0, height])
                .padding(0.1);

            // Draw bars
            svg2.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", margin.left)
                .attr("y", d => y(d.country))
                .attr("width", d => x(d.life))
                .attr("height", y.bandwidth());

            // Add X axis
            svg2.append("g")
                .attr("transform", `translate(${margin.left},${height})`)
                .call(d3.axisBottom(x));

            // Add Y axis
            svg2.append("g")
                .attr("transform", `translate(${margin.left},0)`)
                .call(d3.axisLeft(y));
        }

        async function loadSceneThree() {

            const data = await d3.csv('https://oliverwang008.github.io/country_life_gdp.csv');
            const margin = { top: 10, right: 20, bottom: 10, left: 45 };
            const width = 800 - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;
    
            // Append SVG to the chart div
            svg3.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // X scale
            const x = d3.scaleLinear()
                .domain([72, d3.max(data, d => d.life)])
                .nice()
                .range([0, width]);

            // Y scale
            const y = d3.scaleLinear()
                .domain([10000, d3.max(data, d => d.gdp)])
                .nice()
                .range([height-margin.top, margin.top]);

            // Draw dots
            svg3.selectAll(".dot")
                .data(data)
                .enter().append("circle")
                .attr("class", "dot")
                .attr("cx", d => x(d.life))
                .attr("cy", d => y(d.gdp))
                .attr("r", 5);

            // Add labels
            svg3.selectAll(".dot-label")
                .data(data)
                .enter().append("text")
                .attr("class", "dot-label")
                .attr("x", d => x(d.life))
                .attr("y", d => y(d.gdp) - 5) // Adjust label position
                .text(d => d.country);

            // Add X axis
            svg3.append("g")
                .attr("transform", `translate(${margin.left},${height})`)
                .call(d3.axisBottom(x));

            // Add Y axis
            svg3.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`)
                .call(d3.axisLeft(y).tickFormat(d3.format(",.0f")));
        }

    </script>

</body>

</html>